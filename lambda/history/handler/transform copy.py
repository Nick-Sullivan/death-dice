# Uploads DynamoDB stream events to S3

import json
import os
import awswrangler as wr
import pandas as pd
from boto3.dynamodb.types import TypeDeserializer
from collections import defaultdict
from dateutil import parser
from decimal import Decimal

deserialiser = TypeDeserializer()


def transform(event, context):
   """Converts DynamoDB diff streams into files to be stored in s3"""
   print(event)
   print(f"Processing {len(event['Records'])} records")

   tables = defaultdict(list)
   for sqs_event in event['Records']:
      dynamodb_event = json.loads(sqs_event['body'])
      transformed = transform_event(dynamodb_event)
      tables[transformed['table']].append(transformed)

   for table_name, events in tables.items():
      upload_to_s3(table_name, events)

   return {'statusCode': 200}


def transform_event(event):
   response = {}
   event_type = event['eventName']

   if event_type in {'INSERT', 'MODIFY'}:
      key_values = event['dynamodb']['NewImage']

   elif event_type == 'REMOVE':
      key_values = event['dynamodb']['OldImage']

   else:
      raise NotImplementedError(event_type)

   response['meta_event_type'] = event_type
   for key, value in key_values.items():
      response[key] = deserialiser.deserialize(value)

   response = remove_decimals(response)

   return response


def remove_decimals(key_values):
   for key, value in key_values.items():
      if isinstance(value, Decimal):
         key_values[key] = int(value)

      elif isinstance(value, dict):
         key_values[key] = remove_decimals(value)
      
      elif isinstance(value, list):
         key_values[key] = [remove_decimals(v) for v in value]

   return key_values


def upload_to_s3(table_name, events):
   print(events)
   bucket_name = os.environ['BUCKET_NAME']

   first_modified_at = min([e['modified_at'] for e in events])

   date = parser.parse(first_modified_at)
   year = date.strftime('%Y')
   month = date.strftime('%m')
   day = date.strftime('%d')
   file = first_modified_at
   key = f's3://{bucket_name}/data/table={table_name}/year={year}/month={month}/day={day}/{file}.parquet'

   df = pd.DataFrame(events)
   wr.s3.to_parquet(
      df=df,
      path=key,
   )

   # json_key =  f'data/table={table_name}Json/year={year}/month={month}/{file}.json'
   # s3 = boto3.client('s3')
   # s3.put_object(
   #    Bucket=bucket_name,
   #    Key=json_key,
   #    Body="\r\n".join([json.dumps(e) for e in events])  # format required for Athena to process
   # )


if __name__ == '__main__':
   os.environ['BUCKET_NAME'] = 'fake-bucket'
   transform(
   {'Records': [{'messageId': '3693a757-c009-4543-9955-ead1466755e0', 'receiptHandle': 'AQEBlO/MskeCC0vx11AemRESPTVtHv09Q6MvQlF+DFDOWDHXV43jZo33vfNryWlgXEBmaKjbG0/MZG7jjiHaK26FCV7UrmyrKcjQS0YzgmiyI7xoo202BxQhOT2KSyrYQlki2/+HcstzchTAYzBQNsceEbixSGUuZ6V0YyLhBkUtC87PX0N9k+SVsvryp1MKrctX+1zducy0oHArS7Zniqo5i32z8b5eAKiNp0OkpUgOiJpYeW2Eu2+wsStqFO7oW0UmYHhOpstQTj+/QC0EHqVLNAl/Iz36DgjfJXggOsq6Q8IPxO+rIU2lFbZgz1cjEwA5raru0IhtN35+n73hy2rmXDBnVKJA6BTUnUwR99dbMvCkpU9NYwa7wNWRb1hQeDrNqUnshvUrPSAI1wqWV0fnLRpg4eYFJyny4QwAIuRzkIs=', 'body': '{"eventID": "c9b9b97ac9166e393035255446b43ed0", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898814.0, "Keys": {"id": {"S": "RDDM"}}, "NewImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "1"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": true}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": [{"M": {"dice": {"L": [{"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "4"}}}, {"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "1"}}}]}}}]}, "outcome": {"S": "WINNER"}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "ROLL_DICE"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:53.878526"}, "version": {"N": "2"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "OldImage": {"round_finished": {"BOOL": false}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "NEW_ROUND"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:52.366936"}, "version": {"N": "1"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "700000000006849403726", "SizeBytes": 533, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898869480', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452176'}, 'messageAttributes': {}, 'md5OfBody': '2675dee40b7a9431cb72237d64b692a7', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'd786ca6a-3022-487e-b69c-1212e4d5b1da', 'receiptHandle': 'AQEBhLjYZxmMK+EWSG3OAlvznQ6C7Am6tKmMgOFUM0gCY8MFCZweBumKw3aIdBCISRpVf9h7Ze8svOPsNfr6uzSEq/afVM/Jy5utEovZsj22rDWd5P2/qC98I+U6r8KAdpH8s0i6lhMBs9HPYiKvdWSzaWRVakC8aYV7Ypu9rse7hpDTPYdv8hpQYgBtap+wPWOKQhaltdr+DTOr5EDQJM2RzXhYS8FBFgyyHmLdcpP6z2x6b/MGqVhAY5n6aiIQoLLH7SFSCyRR6faUaG3eaQ+eWZ+2Gw00LWpCm/IKYzqHWhobwcCScuJqZ5Xi4+7VgACA8wH/oKSj+ny+KHwGbCb85uSQoWRzhNpHNCZKD7D7gMWFy7CTCFmKVqfunScs+ML26sTfVOBDwum4c6do1Skn1yW1wvfztsCfErwjAWrF0Kw=', 'body': '{"eventID": "acff18dc8581e8dfd55175f4694ec5ee", "eventName": "REMOVE", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898815.0, "Keys": {"id": {"S": "RDDM"}}, "OldImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "1"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": true}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": [{"M": {"dice": {"L": [{"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "4"}}}, {"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "1"}}}]}}}]}, "outcome": {"S": "WINNER"}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "ROLL_DICE"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:53.878526"}, "version": {"N": "2"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "800000000006849404734", "SizeBytes": 311, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898869482', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452180'}, 'messageAttributes': {}, 'md5OfBody': '32ae790e04aeaac799497edca939fd9a', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '651ba6ea-919a-4378-a010-64ba7159e79a', 'receiptHandle': 'AQEBdNFy4JD+pWfuS4fO4Vhuw05yd0ksorNQW5W9YirvjwZGiShlGFaNE/iHGtA3F26MJ9FqRtJShJ+e3cdkLPTs9gGYa6y50TXlpVkiJIbuALPO8bH30rfC/fyKtt73E7A2FV1qfXym8q4oFnL9I2u6Z/3/PZPMq8Ir5rEuWFIs6ZL4kSREgGNAIAkjc4ZkwWsu35kYCrSI+O20Hiya9dX0ewFNdpzgB3OmmjBMl/gdonckXdG9V7XqauzUQcZz4WBd3Fmi97T6DtX4L4IaQ1JmR52Yo9ohxmtjD7H3Ul3Vt+9cmiHEqnecBr4Y9E597hTde2oDfcJDKxE5B2Lctl6FyBnk0J9PE+wDsuOxbR9FEENogttfX8UgQlXarFRWyLfHwk+qDDFRlKorCj+HELtd3owQEDGkvBcdIQWXVqbxpgA=', 'body': '{"eventID": "87607d4b5f29faa312355d8b991b9316", "eventName": "INSERT", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899055.0, "Keys": {"id": {"S": "JYFI"}}, "NewImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "CREATE_GAME"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:55.374337"}, "version": {"N": "0"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "900000000006849525692", "SizeBytes": 229, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899110201', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452215'}, 'messageAttributes': {}, 'md5OfBody': '90e1faa819a56646694bd5af30e4a97f', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'a6e4b54f-6941-4634-8eed-2216b39c71fe', 'receiptHandle': 'AQEB1TLfBIZoVk/tkqk/4EcDp5Gl0mt5y0CUYQWkL+8G5OHRsQKh3uo/Pn+WCALQPZFpoOJ6fo+a+Fn2C/0h6ChyS/5iKtKsR9bUCT8qDOE1R5UZbVKGsEnGfYXXx6C9UKi+GR1h0p//i/zgrn4/BKMqUiNCPaOxQI/iFOSamy6K799GfsWylxbUf2gQ3LUArCH5Xsb2OzzEa3KjQdHWJc8WucZOSaQLZK8oCGfhGKXnAIhO1hGCSXMpURIwmWCeFwNApy/lYIOS987bQW1ePeQYzXyIyjcGEuJITPcTaeHLgY2N0ROs0AFy/UzdOtEHcZFOBvh+z0XK+pyHpq7NpLJcMTZH46CV5rRTRoA/M0e1nMfS+WDywgrjl8Weznu4b0tJtESVcSKHC9uA8cDgxkMaH/ejOyUlrsirnO9O1OULgtY=', 'body': '{"eventID": "b5578db60604f283b79524e376407768", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899056.0, "Keys": {"id": {"S": "JYFI"}}, "NewImage": {"round_finished": {"BOOL": false}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "NEW_ROUND"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:56.391366"}, "version": {"N": "1"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "OldImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "CREATE_GAME"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:55.374337"}, "version": {"N": "0"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "1000000000006849526268", "SizeBytes": 451, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899110208', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452217'}, 'messageAttributes': {}, 'md5OfBody': '05aa4546caa64dfccfc941e41da8bc1d', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'f4f01435-57d4-460f-8e38-aee89a88fc0f', 'receiptHandle': 'AQEBeGdL80mAzm6plPQDz49aiLRLnXZNz7L0Ia3c14s+v53/ZuaiRtHRGeq4PMz/9hIMRhn7kBd1HFnWE2ZyJPLaL/YduMR/cac6mQSa8gZ9fyzR7wTiao/kt7qw0vsaY1Tqe0bB6F34i1ASJZlLtZqCHH525Px6F4pmUaML1KA6970rh8raXFq62kC1N7dZHQRMCzN9mnv9OK6cKlZrMHjrYe1Miyzt1kiRDlJRI+Zl9CLP0EZusuGsqi8AHCMsV7c/iy6RvUtJm2WFlTTh9Bq9d88yOv+lvpZVY5MGLAwRd9DbYy6xIal91mHQFt3YxkJ8N7MJ6iL022Qv10UJus1kslORgiiwAEsMpi3/fjzgyjQSoMMi2sjGFHsvQl6A39rdFHr1+7+muOh7mjOLShUjkIq0hesURdutdzSnphDkrdE=', 'body': '{"eventID": "342a1e0de4bc95385d4cb7b46c0f814f", "eventName": "INSERT", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898807.0, "Keys": {"id": {"S": "eQVWjfJwywMCJLw="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"NULL": true}, "modified_action": {"S": "CREATE_CONNECTION"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:47.051986"}, "version": {"N": "0"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "100000000006997655167", "SizeBytes": 156, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898871664', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452249'}, 'messageAttributes': {}, 'md5OfBody': '46bf4dc3acc0af61a28d64b6c79a4839', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '6688fefe-d446-4cdc-b507-dbbc915fe2ec', 'receiptHandle': 'AQEBXw+WPDX/+RELKu/v9bAGbCWHDLCY+9BoC+bNB2vL/8+FgcV5nw9BON1Oqpe8MveyRFRChapTYGHE/VWYA4ATebhVt37z1vZ1QdtfzEq4PPpdWGPPA2XZb0CH/1K7j38jZ7QNblWUQmJ+74O+f3aOl32Sb5CINMcSuv8oibPxc18c/daDJXzkdxHB2B7KaXdc+RIZSb+5HBSk5U79cXd6XBSQRUnr5C/EonvF0FAdZGjkfVyrlbeOW+JWuAydoj5P+2mXnAgTp9S7RgxySiZ7a5lVQBjbj3zgIoG/Moa/dfu8lujlmt4/0cO2Nr8ZprO/nEeyQF0Gfa4EBIvH6gyQcUHn39zBMSCPYYS+vk4NziE5Ak3khAy/qCcYS4DmWpk5Cd5nzpiYKuk9NAH4AGot6mBbQqG2NQhoJ1wiZENAS6Q=', 'body': '{"eventID": "40c9b0cf26cc626d98e5b7f8dd6242cd", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898809.0, "Keys": {"id": {"S": "eQVWjfJwywMCJLw="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "SET_NICKNAME"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:48.926505"}, "version": {"N": "1"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"NULL": true}, "modified_action": {"S": "CREATE_CONNECTION"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:47.051986"}, "version": {"N": "0"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "200000000006997656052", "SizeBytes": 293, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898871669', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452251'}, 'messageAttributes': {}, 'md5OfBody': 'f10d7505cb1785d2cf7620f19a94ca67', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'fc5368ac-2334-461e-b4fa-42850ca5f1e1', 'receiptHandle': 'AQEBAsvdX3VDSM/CygR0JVhexsYRjkkVkDDMm3kvkHKElxI05C5/K1ASTo8u0ezjZ/cPY4QQlNUhrWmVQAkBXG/hCx+aq7ZQ5x8wMnKP8aFjHVaccvRo3b83nTYpoHuiRh9GGf8wqsJ3yFYlLR1g6uDV89mE1gEbruYstN3n6WbheR5U6jaUd0TJx810tCTlGhYNG0sHhZz5IybeNXC8dY9lE8eXfDvLbEt0nRt3G24Wly1F5byG4UBZJ3I8PYz6f17p9ApfCsWL4sdtkPtLdtF9mnwRg1u6NKpfT1bIt6OIs46Is/pvYPKudmIxL6PvHQvG2BOj4a1EwXkrxzbjlCC42q0QJ3Hqt64/8H2UFcCzaXJXDLugZhIUG/0eZEjWN29zkp9JJdE85VukeAODldgoMmMwmVR3RDGXbZVJq7PSoTQ=', 'body': '{"eventID": "3cc81cc2d50d01d903f0961111b11d19", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899055.0, "Keys": {"id": {"S": "eQV9DcM3SwMCGIg="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "JOIN_GAME"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:55.374142"}, "version": {"N": "2"}, "table": {"S": "Connection"}, "game_id": {"S": "JYFI"}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "SET_NICKNAME"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:54.513599"}, "version": {"N": "1"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "700000000013276833993", "SizeBytes": 292, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899109423', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452251'}, 'messageAttributes': {}, 'md5OfBody': '0310a8b6aaf35fab8a68087089b50c23', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '0b396804-127d-47a4-9d7f-67620ee0ca2f', 'receiptHandle': 'AQEBK7v2/xUK5l1vxRbVaqX7WF4NDtO2oFAk4QXaSp26JKJ4s+73edypGjOmeHEhboJ4y/yC/wAnribiyvIQRirA+NpFdx2li9pupBMtbSN4VI1fUigt54JROUVPKYG7F/t2N4REyU0rFaZ0rW27ACDCq+dHiX3jWoJiVB4EenuOfSdznpIjeCI3q9/8/qjmOCDbXYgt6AN9RQzCm5kDKGYaWUPnC5rXWYVgseL/jP2OuIFPwYIC4KkXhFnVknU+ccA3pEA1zyxJFr1qrFX4bwNA3ABbdoqVhU8Ei7hGn8RHOf2zjJeOeLHY3xhKT7N6dBHDe6H3mtK8WSk/cvfV4lr3cG5mveKSUtrGJ+91LyVo6+lXaUIa9g3ch5uXnX2dJEKiHPvaMME/BoTjx21DOgFF+qIJqdBnUWPyHkVLIyXaae0=', 'body': '{"eventID": "6a5b01657a6f97a6421cff0fb7a817e9", "eventName": "REMOVE", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899058.0, "Keys": {"id": {"S": "eQV9DcM3SwMCGIg="}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "JOIN_GAME"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:55.374142"}, "version": {"N": "2"}, "table": {"S": "Connection"}, "game_id": {"S": "JYFI"}}, "SequenceNumber": "800000000013276837087", "SizeBytes": 155, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899109425', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452251'}, 'messageAttributes': {}, 'md5OfBody': '1ddae461b123936a695c7a3c44766505', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '52f73261-2656-4576-b644-cc97ff85d8c4', 'receiptHandle': 'AQEBClz1YaJUVUM/omEOQPmbGgCbCxmUn/abXV/KOTgjEOjAEVA9RcKJYZ8DChafFBMRvRE/d8T3PekD0BH74gcoLgmJTYAVtEqTxK13BbNog4/SJ9EqlqpnY0KH42iCUPJUrEbjiYhKggE5H+JBXqYr+fvu7iw6thy01dMHCP84klxl5dvhCmYpwZ2Ds9xF9GLdnEmOzVV+e2IzSF77oG1hybFv/VbfbJNW3aQ0c9CosUMtqReSYSZlUXr8QtxUC0JDf1UM6djwfmSF3WSLV7KmoTlC2i9cSzokNLUIfi/x1Jv7+KsFDE6K1wDu5HoAMAZFdgumx9Eyr0wU0OyLlDls54hy7ggFyOX+lV9A2NSLc4J0zA6z5V6A+0nznXXoKByJl6Cc0x9OI7ipUHl6ccZ+Dtzzo1Hwoudv8icHJdwu98k=', 'body': '{"eventID": "11eb5a3bfe0c788f9f4504ed6433f15e", "eventName": "INSERT", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898810.0, "Keys": {"id": {"S": "RDDM"}}, "NewImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "CREATE_GAME"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:50.566088"}, "version": {"N": "0"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "500000000006849402248", "SizeBytes": 229, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898869480', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452291'}, 'messageAttributes': {}, 'md5OfBody': 'd2cd6f755dc425e79ae72fe94627ff20', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '278cd440-87c1-404b-8f67-6d87980d1e49', 'receiptHandle': 'AQEBFYEFQ/T5tAr8UHNduVH1SuvdNfJGTBqXPtscbigrEP8VFYj37DTQ07qDImuDaBkXSVpQN57m5D1/vCAaEwj1z9+AU2XeuaclCfphk7TYcaUmT3GmUv35kOoO/1kVGMlLy0fsqYCfKBIP9+eIlb6+95sFJn/SAHdSUlbx/b4VFqgNUNEakptFhY8MFTSRtyM+0MxBbJPJFN8HZVEqdGBE8Exu7xjQoRYM0xylQidE0y8no8QekoNOtxAzZKk634xJSPKYf4BT2aMoi0gmiijOss0tMk+wUGm4saBvhANlQrYTX/Juv6afh35VhwrHf2zToutngi9qQqidAONU3fr2bqNkBq5ikJBAfkyVN131KEd1jx1iDpD51kCLvxON20a+KWSdssK4jF7uMwPh6cOgbf9fLi3UUjrPLdp45Acp9Co=', 'body': '{"eventID": "78bb3d8a194387e89976d8bf188d2287", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898812.0, "Keys": {"id": {"S": "RDDM"}}, "NewImage": {"round_finished": {"BOOL": false}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "NEW_ROUND"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:52.366936"}, "version": {"N": "1"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "OldImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQVWjfJwywMCJLw="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQVWjfJwywMCJLw="}, "modified_action": {"S": "CREATE_GAME"}, "id": {"S": "RDDM"}, "modified_at": {"S": "2023-01-05 06:06:50.566088"}, "version": {"N": "0"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "600000000006849402963", "SizeBytes": 451, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898869489', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452293'}, 'messageAttributes': {}, 'md5OfBody': '2fe35aee1692ec19467f332f183d3ec9', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'b38ff52d-b5af-4aa7-9bd7-721f66f7fda8', 'receiptHandle': 'AQEBZhMOQjZfMM//jfyfsGGcQRGOIhN2mhRZQd+Ds6TTrGJX3l6CMoYY0SHKlrMNNhjnqwfbgrHRb6ahyfRBpHeNJnvlRiTo34GVy3D5xO0ELG56cVn54WPOjclFzuFwQXf3gW38w3MbWXFqICBGdayBhRkheK1JaMgeLG9Iww+aR8gtGUY7oQ9UoqazXBwBR93Oz3qwvULFEyCvBXHGdo5MH9iwfjX072Vb61+RGkBH8W5DnwiYkBJ6wViTQQ1vfMfKCY8xYQ8E2ymj2I9XdheggdXXh2HzN2qoWxXHO1YDhxE1r74opNxG9tr2SZ8F+ZzlYaGHDyYttvGfYDowJjZHRcwMGYgsUECG8zIQhMcN/IbR0UJX0o4s7XrCgx7w3Y6tv/2aBODC8f3ZyFf23JxqF/yepH4OUJ2Z1mVp8xfbmKk=', 'body': '{"eventID": "d9823394d566a65efa4a4cb86f88ddfb", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898810.0, "Keys": {"id": {"S": "eQVWjfJwywMCJLw="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "JOIN_GAME"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:50.565853"}, "version": {"N": "2"}, "table": {"S": "Connection"}, "game_id": {"S": "RDDM"}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "SET_NICKNAME"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:48.926505"}, "version": {"N": "1"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "300000000006997657095", "SizeBytes": 292, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898871664', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452345'}, 'messageAttributes': {}, 'md5OfBody': 'a5178b97348058c00bbc783811ef5e9d', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '630245b1-3108-4f82-8c24-1b8bf053529e', 'receiptHandle': 'AQEB6CunLt0mIXVh8WssuYZ2corKE04PD9mfrCo8ihLNWG+LUHiAqnNcEZZgWIoVCxdDaYAU3rbTniviqiXLYvuoupcnXkknjI73oH6Y/NdnVWi1TKAP3wwXm4TiKERFSmjgCf624heVqEKH/zpVaET7Efo3eZxUPwUiSrrGimOPEQl8lmhLa4kVJQ0EW2FOBs72+vSBcf1wT5fLQXk/WZ/EI9G2F1qrADIaWb0G0AGXyE9kne6eb8kvU1Im5LT5lxadC8L8H1OPNpOap8xLUlXX4fcpuoC5wJqoFdxwEFqgHavqgoivXjxJnfNG/kop4m0/6o8+AxX7YjPqhJhF4l5ZAxWEbu29VaktB5VDErGAyFotYltzdkpX5KGYPH4SW9r9tFGrqys8Vxg1t2RNS761In0Z2q7Ll5fEkZFpRYghXnU=', 'body': '{"eventID": "d376f1eb7c130f77b13af8bc91e34936", "eventName": "REMOVE", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672898815.0, "Keys": {"id": {"S": "eQVWjfJwywMCJLw="}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "JOIN_GAME"}, "id": {"S": "eQVWjfJwywMCJLw="}, "modified_at": {"S": "2023-01-05 06:06:50.565853"}, "version": {"N": "2"}, "table": {"S": "Connection"}, "game_id": {"S": "RDDM"}}, "SequenceNumber": "400000000006997660778", "SizeBytes": 155, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672898871672', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452347'}, 'messageAttributes': {}, 'md5OfBody': '82f84cfd1551fe105c7f1dd22a1cfc69', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'f4fb93eb-e1d1-4362-9600-ba65f0a74eab', 'receiptHandle': 'AQEBY0WsxjVM2w4iI7ik+9s777GjTBcNsGA1rV7NM3O+/ziToNCYEI1gxsiL6CiBwsQc0r2n3yH79wKoCf/Jc5A7hVV5Nbcmnf2nQ8SrtwpCYqO3cq+DeJxj8v7BCOcLUZtuxsdrQhmPeKe40AMmfaRdINOlDfhBvZRHP4ilkUaJ2c6d4q+NG1sz1W5x27YcnLxcdskrLKt+HXIVcFH/nhyntN00tYm3krwZY/WKMXfsV7WHJnscgBSCXlsRystY+EJq4p+uBluxhCjzEInZMZ58hLmCIs+VRaCMfZVtFAMDczK5Ki57gC+ALZ3+MakhlBT/s9iP4/i3gl2hbtFYfvFbSIxJkQ/CSHuYrdimyrZ0BanrYrsfofe9lbAoh0GYcf0DTyaCbGbZbcsKlm2VQF8okaGOMUrOubP82Ayh7MQEy1U=', 'body': '{"eventID": "d2954737396f6d546e181bf50085e6cf", "eventName": "INSERT", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899053.0, "Keys": {"id": {"S": "eQV9DcM3SwMCGIg="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"NULL": true}, "modified_action": {"S": "CREATE_CONNECTION"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:52.993141"}, "version": {"N": "0"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "500000000013276832375", "SizeBytes": 156, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899109423', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452347'}, 'messageAttributes': {}, 'md5OfBody': 'ef90f63f7eee43f19e5ae5875bc171cb', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'ce7584d0-850d-4d15-93a3-407a7be7abd7', 'receiptHandle': 'AQEBiSdmWssm+R1FEd8FplOZ8GopuwMbIYcaTw7BZCuuCW+33CUnRLNrdEdgTr9nFKAGuMkMNaj1yRxyTAY6vqHBCgAvYOB2NEGkGRCBNr6rAJ0u5Pv9XvsfNwSSrylYJMLywElDZL8ZUTWaIGFInq9H90adF2+VakHrOp/RueBcI3kTPIqX1vzyhSrr1Nyew/P77UYb73cE/xMq/AKtzelRN/ldgjYAo2WxSEypyE5j52TIlK3YiP/wzJIKSQWOdQPH1vVN2cArc4wMm4vUQwsMiRp0io/OKRfwu0X/pSOBRkreRQQukRFdTtp1PaUpwjpY5RiQp/+Br2EEissP7NzbSnu4MzfpsfrXdco+tWyU8yh3s7Le16G6CaAhbd3ipY8/f+IA8cUJNBJIImuI/xQXQfd034bdWsPj/W9BnPYfCv8=', 'body': '{"eventID": "3648e94053cacbe5a9019d692d10b933", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899054.0, "Keys": {"id": {"S": "eQV9DcM3SwMCGIg="}}, "NewImage": {"account_id": {"NULL": true}, "nickname": {"S": "Nick"}, "modified_action": {"S": "SET_NICKNAME"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:54.513599"}, "version": {"N": "1"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "OldImage": {"account_id": {"NULL": true}, "nickname": {"NULL": true}, "modified_action": {"S": "CREATE_CONNECTION"}, "id": {"S": "eQV9DcM3SwMCGIg="}, "modified_at": {"S": "2023-01-05 06:10:52.993141"}, "version": {"N": "0"}, "table": {"S": "Connection"}, "game_id": {"NULL": true}}, "SequenceNumber": "600000000013276833312", "SizeBytes": 293, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899109424', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452347'}, 'messageAttributes': {}, 'md5OfBody': '9f785f666a6afcd6d6770aed7b98ba78', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': 'e76dec29-ba7b-4db4-97c5-8c9ee6a98c74', 'receiptHandle': 'AQEBrPcSbU5STZPqTP939CZzhLE3gY0KA/WeTaQeF+eafUQfEH3tjGzWlXCrbCJ2ITLXiG65BgM5CJywoFvrnhdmViuqLUQtjDehc+6qWQmKSFoHi2hgY2EnBqmA/VtfA6HQZI9xveuQAAwF+q9yDptTgoQz6hbwwJJNsxZnH48K3VAfteLEQhlFghcosDhG+a9HmEznZWf4g5davyCsYRiCU3wKOEt6DZjxnmRGm4UC6fLkxzNWxTLELvPVG2YnPKxGyC4OOGVNNSZ22LvcLZ5cQfj4h+HWKWPRgzXOY3SGddFn5TGjSqjM4R3mutsXqNOgzmRzBi5KEH3JJSHlORhmtJO27/z+UfoMAe01kPpx5NjREUAH3kSA4KQh3LaazUquK1U+wQkh72t9gVYX3keCFn7BPKxaBhEc5iQmYQOce9E=', 'body': '{"eventID": "d164012102eeef86bd7a911d78363025", "eventName": "MODIFY", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899057.0, "Keys": {"id": {"S": "JYFI"}}, "NewImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "1"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": true}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": [{"M": {"dice": {"L": [{"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "2"}}}, {"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "4"}}}]}}}]}, "outcome": {"S": "WINNER"}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "ROLL_DICE"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:57.360047"}, "version": {"N": "2"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "OldImage": {"round_finished": {"BOOL": false}, "players": {"L": [{"M": {"win_counter": {"N": "0"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": false}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": []}, "outcome": {"S": ""}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "NEW_ROUND"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:56.391366"}, "version": {"N": "1"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "1100000000006849526748", "SizeBytes": 533, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899110201', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452347'}, 'messageAttributes': {}, 'md5OfBody': '6d9b2f135863bcb91c9a9c99d7003b69', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}, {'messageId': '5a762cc2-79dc-49cf-9bdd-65ef3f1aaa27', 'receiptHandle': 'AQEBb3B5+dhrWKF8iuGCf4sY3IfNuRbf9wt6V1x0e8LUEC1/7LNMNy1L0H1VNOPDypQIQcxWzqPUrY0XvD+Igi6XBFi2/iu9EPyREbmep6cMik6zanx537Z7E3S0S9b3F85OUHa/2QgMbeWg9Ps/sjxkkUO2t4/RTV27m1PQ3N6MRdGmSl2Hx71MZdUxDhRBQlXNwNtNdhxFFylnqkMSldrwzXadY4Gfo6ZE+z40n+v1N1M/n9ngFlnxVNh7FNg7xMbFJQUNZAUKL6Lw/EvQTCCVIcW6mM9oV4wBKnP2wksZgtKtpVEttRQ9IaZuOMs8M1m8bv6Y/+UGF5MdubdlMkLBP7P9lBh29eBg3o/KnZSFZq4jaCT0QlMK3Xb2lrhiBl3kavp6aifAngC7RL/qq3kBkI+SJ2IAG0RyVywltK6tVn0=', 'body': '{"eventID": "9b4799e1c21dc4fbc7d2838b6e156a01", "eventName": "REMOVE", "eventVersion": "1.1", "eventSource": "aws:dynamodb", "awsRegion": "ap-southeast-2", "dynamodb": {"ApproximateCreationDateTime": 1672899058.0, "Keys": {"id": {"S": "JYFI"}}, "OldImage": {"round_finished": {"BOOL": true}, "players": {"L": [{"M": {"win_counter": {"N": "1"}, "nickname": {"S": "Nick"}, "finished": {"BOOL": true}, "id": {"S": "eQV9DcM3SwMCGIg="}, "rolls": {"L": [{"M": {"dice": {"L": [{"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "2"}}}, {"M": {"is_death_dice": {"BOOL": false}, "id": {"S": "D6"}, "value": {"N": "4"}}}]}}}]}, "outcome": {"S": "WINNER"}}}]}, "modified_by": {"S": "eQV9DcM3SwMCGIg="}, "modified_action": {"S": "ROLL_DICE"}, "id": {"S": "JYFI"}, "modified_at": {"S": "2023-01-05 06:10:57.360047"}, "version": {"N": "2"}, "table": {"S": "Game"}, "mr_eleven": {"S": ""}}, "SequenceNumber": "1200000000006849527209", "SizeBytes": 311, "StreamViewType": "NEW_AND_OLD_IMAGES"}, "eventSourceARN": "arn:aws:dynamodb:ap-southeast-2:314077822992:table/DeathDiceStage/stream/2023-01-05T05:17:16.783"}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1672899110203', 'SenderId': 'AROAUSID7IAICHHORTYKA:DeathDiceStage-Extract', 'ApproximateFirstReceiveTimestamp': '1672900452347'}, 'messageAttributes': {}, 'md5OfBody': 'de7949fa35750de4978eded6b1b108f6', 'md5OfMessageAttributes': None, 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:ap-southeast-2:314077822992:DeathDiceStage-Extract', 'awsRegion': 'ap-southeast-2'}]}
   , None)
